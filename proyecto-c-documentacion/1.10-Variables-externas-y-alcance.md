# 1.10. Variables Externas y Alcance (Scope)

Un programa en C puede consistir en múltiples funciones distribuidas en varios archivos fuente. Una **variable externa** es aquella definida fuera de cualquier función, lo que le permite ser accesible por diferentes funciones y, crucialmente, por diferentes archivos. Son el mecanismo principal de C para compartir datos globalmente.

El **alcance** (o _scope_) de una variable determina la región del programa donde esa variable es visible y puede ser utilizada.

## Definición vs. Declaración

Para entender las variables externas, es vital distinguir entre definición y declaración:

- **Definición**: Es donde la variable es creada y se le asigna memoria. Ocurre solo una vez. `int x;` o `int x = 10;` fuera de una función es una definición.
- **Declaración**: Anuncia las propiedades de una variable (su tipo y nombre) pero no reserva memoria. Se usa para hacer visible una variable definida en otro lugar. La palabra clave `extern` se usa para esto.

## El Papel de `extern`

La palabra clave `extern` le dice al compilador: "Estoy usando esta variable aquí, pero su definición (su memoria) está en otro archivo. Confía en mí, el enlazador (_linker_) la encontrará".

### Ejemplo Práctico con Múltiples Archivos

Imaginemos que reescribimos el programa de la "línea más larga" de la sección anterior para que las variables `line`, `longest` y `max` sean externas y compartidas por las funciones.

**`main.c`**

```c
#include <stdio.h>

#define MAXLINE 1000

// Definición de las variables externas
int max;
char line[MAXLINE];
char longest[MAXLINE];

// Prototipos de funciones que están en otros archivos
int getline_custom(void);
void copy(void);

int main() {
    int len;
    extern int max; // Declaración opcional, ya son visibles en este archivo
    extern char longest[];

    max = 0;
    while ((len = getline_custom()) > 0) {
        if (len > max) {
            max = len;
            copy();
        }
    }
    if (max > 0) {
        printf("%s", longest);
    }
    return 0;
}
```

**`getline.c`**

```c
#include <stdio.h>

#define MAXLINE 1000

// Declaración de las variables externas que necesita
extern char line[];

int getline_custom(void) {
    int c, i;
    extern char line[]; // También se puede declarar dentro de la función

    for (i = 0; i < MAXLINE - 1 && (c = getchar()) != EOF && c != '\n'; ++i) {
        line[i] = c;
    }
    if (c == '\n') {
        line[i] = c;
        ++i;
    }
    line[i] = '\0';
    return i;
}
```

**`copy.c`**

```c
#include <stdio.h>

// Declaración de las variables externas que necesita
extern char line[], longest[];

void copy(void) {
    int i = 0;
    while ((longest[i] = line[i]) != '\0') {
        ++i;
    }
}
```

**Compilación:**
Para compilar este programa, debes pasar todos los archivos fuente al compilador:
`gcc main.c getline.c copy.c -o mi_programa`

### Análisis del Ejemplo

- Las variables `max`, `line` y `longest` se **definen** una sola vez, en `main.c`, fuera de cualquier función.
- Los otros archivos, `getline.c` y `copy.c`, usan `extern` para **declarar** que utilizarán esas variables, permitiendo al compilador verificar los tipos.
- Las funciones `getline_custom` y `copy` ya no necesitan parámetros porque operan directamente sobre las variables externas compartidas.

## Ventajas y Desventajas

| Ventajas                                                                                                    | Desventajas                                                                                                                                                       |
| :---------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Simplicidad:** Puede simplificar la comunicación entre funciones al eliminar largas listas de argumentos. | **Acoplamiento Fuerte:** Las funciones se vuelven dependientes de variables globales, lo que dificulta su reutilización en otros contextos.                       |
| **Compartir Datos:** Es el método estándar para compartir datos entre diferentes archivos fuente.           | **Mantenimiento Difícil:** Es difícil rastrear qué función modifica una variable global y cuándo, lo que puede llevar a errores sutiles y complicados de depurar. |
|                                                                                                             | **Menos Legibilidad:** El flujo de datos no es explícito a través de los parámetros de la función, lo que hace el código más difícil de entender.                 |

## Regla General

El uso de variables externas es necesario en ciertas situaciones, pero debe manejarse con cuidado. La práctica moderna de la ingeniería de software favorece la **encapsulación** y la comunicación explícita a través de parámetros de función.

**Usa variables locales siempre que sea posible.** Recurre a variables externas solo cuando los datos deban ser compartidos por necesidad entre múltiples funciones y archivos, y documenta claramente su propósito y uso.

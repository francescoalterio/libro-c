# 1.5.1. Copia de Archivos

El programa de copia de entrada a salida que vimos anteriormente es la base para una utilidad de copia de archivos. En sistemas operativos tipo Unix (y por extensión, en la línea de comandos en general), es común usar redirección de E/S para hacer que un programa que lee de la entrada estándar y escribe en la salida estándar trabaje con archivos.

## El Programa Básico de Copia

Recordemos el programa:

```c
#include <stdio.h>

/* Copia la entrada a la salida; 1a. versión */
int main() {
    int c;

    c = getchar();
    while (c != EOF) {
        putchar(c);
        c = getchar();
    }
    return 0;
}
```

Este programa no sabe si está leyendo del teclado o de un archivo. Tampoco sabe si está escribiendo en la pantalla o en un archivo. Simplemente lee del "flujo de entrada estándar" (`stdin`) y escribe en el "flujo de salida estándar" (`stdout`).

## Redirección de E/S

La redirección es una característica de la línea de comandos (shell), no de C. Permite conectar la entrada y salida estándar de un programa a archivos.

- `<`: Redirige la entrada estándar.
- `>`: Redirige la salida estándar.

Supongamos que compilamos nuestro programa y el ejecutable se llama `copiar`.

### Ejemplo de Uso

Si tenemos un archivo llamado `origen.txt` y queremos copiar su contenido a `destino.txt`, podemos ejecutar nuestro programa de la siguiente manera:

`./copiar < origen.txt > destino.txt`

**¿Qué sucede aquí?**

1.  **`./copiar`**: Es la orden para ejecutar nuestro programa.
2.  **`< origen.txt`**: La shell abre el archivo `origen.txt` y lo conecta a la entrada estándar (`stdin`) del programa `copiar`. Cuando el programa llama a `getchar()`, en lugar de esperar un carácter del teclado, lee el siguiente carácter del archivo `origen.txt`.
3.  **`> destino.txt`**: La shell crea (o sobrescribe si ya existe) el archivo `destino.txt` y lo conecta a la salida estándar (`stdout`) del programa. Cuando el programa llama a `putchar()`, el carácter no se muestra en la pantalla, sino que se escribe en el archivo `destino.txt`.

Cuando `getchar()` llega al final del archivo `origen.txt`, devuelve `EOF`, el ciclo `while` termina y el programa finaliza. El resultado es una copia exacta de `origen.txt` en `destino.txt`.

## El Pipe (`|`)

Otra característica poderosa de la shell es el "pipe" o tubería, que conecta la salida estándar de un programa con la entrada estándar de otro.

Por ejemplo, si tuviéramos un programa `contar_palabras` que lee de su entrada estándar, podríamos hacer esto:

`cat origen.txt | ./contar_palabras`

- `cat origen.txt`: Escribe el contenido de `origen.txt` en su salida estándar.
- `|`: El pipe toma esa salida y la convierte en la entrada estándar para `./contar_palabras`.

## Ventajas de este enfoque

- **Simplicidad:** El programa en C es extremadamente simple. No necesita saber nada sobre cómo abrir, leer o cerrar archivos.
- **Reutilización:** Una herramienta simple que hace una cosa bien (copiar `stdin` a `stdout`) puede ser combinada con otras herramientas de la línea de comandos (`<`, `>`, `|`) para realizar tareas complejas.
- **Filosofía Unix:** Este es un ejemplo clásico de la filosofía de diseño de Unix: "Escribe programas que hagan una cosa y la hagan bien. Escribe programas que trabajen juntos. Escribe programas que manejen flujos de texto, porque esa es una interfaz universal."

Más adelante (en el capítulo 7), aprenderemos a manejar archivos directamente desde el código en C usando funciones como `fopen()`, `getc()`, `putc()` y `fclose()`, lo que permite un control mucho más fino (por ejemplo, manejar múltiples archivos a la vez o trabajar con archivos binarios). Sin embargo, el modelo de `getchar`/`putchar` con redirección es fundamental y muy potente.

# 2.12. Precedencia y Orden de Evaluación

Cuando una expresión contiene múltiples operadores, C se basa en dos reglas fundamentales para determinar cómo se calcula el resultado: la **precedencia** y la **asociatividad**. Comprender estas reglas es vital, pero aún más importante es saber cuándo el orden de evaluación no está garantizado.

## Precedencia de Operadores

La precedencia determina qué operadores se agrupan con sus operandos primero; es decir, qué operaciones se realizan antes que otras. Los operadores con mayor precedencia se evalúan antes que los de menor precedencia.

Por ejemplo, en `a + b * c`, el operador de multiplicación `*` tiene mayor precedencia que el de suma `+`, por lo que la expresión se evalúa como `a + (b * c)`.

### Tabla de Precedencia (Simplificada, de mayor a menor)

| Nivel | Operadores                                          | Descripción                                                                                       | Asociatividad       |
| :---- | :-------------------------------------------------- | :------------------------------------------------------------------------------------------------ | :------------------ | ------------------- | ------------------- |
| 1     | `()` `[]` `->` `.`                                  | Llamada a función, índice de arreglo, puntero a miembro, miembro                                  | Izquierda a Derecha |
| 2     | `!` `~` `++` `--` `+` `-` `*` `&` `(tipo)` `sizeof` | Unarios: NOT, complemento, incremento/decremento, más/menos, indirección, dirección, cast, tamaño | Derecha a Izquierda |
| 3     | `*` `/` `%`                                         | Multiplicación, División, Módulo                                                                  | Izquierda a Derecha |
| 4     | `+` `-`                                             | Suma, Resta                                                                                       | Izquierda a Derecha |
| 5     | `<<` `>>`                                           | Desplazamiento de bits                                                                            | Izquierda a Derecha |
| 6     | `<` `<=` `>` `>=`                                   | Relacionales                                                                                      | Izquierda a Derecha |
| 7     | `==` `!=`                                           | Igualdad                                                                                          | Izquierda a Derecha |
| 8     | `&`                                                 | AND a nivel de bits                                                                               | Izquierda a Derecha |
| 9     | `^`                                                 | XOR a nivel de bits                                                                               | Izquierda a Derecha |
| 10    | `                                                   | `                                                                                                 | OR a nivel de bits  | Izquierda a Derecha |
| 11    | `&&`                                                | AND Lógico                                                                                        | Izquierda a Derecha |
| 12    | `                                                   |                                                                                                   | `                   | OR Lógico           | Izquierda a Derecha |
| 13    | `?:`                                                | Condicional (Ternario)                                                                            | Derecha a Izquierda |
| 14    | `=` `+=` `-=` `*=` `/=` `%=` `&=` `^=` `            | =` `<<=` `>>=`                                                                                    | Asignación          | Derecha a Izquierda |
| 15    | `,`                                                 | Coma                                                                                              | Izquierda a Derecha |

## Asociatividad

La asociatividad se utiliza cuando una expresión tiene varios operadores con la **misma precedencia**. Determina el orden en que se agrupan: de izquierda a derecha o de derecha a izquierda.

- **Izquierda a Derecha:** `a - b - c` se agrupa como `(a - b) - c`.
- **Derecha a Izquierda:** `a = b = c` se agrupa como `a = (b = c)`.

## El Peligro Oculto: Orden de Evaluación de Operandos

Aquí es donde C se vuelve complicado y se diferencia de muchos otros lenguajes. **La precedencia y la asociatividad NO garantizan el orden en que se evalúan los operandos de un operador.**

Por ejemplo, en la expresión `f() + g()`, C no especifica si `f()` se llamará antes que `g()` o viceversa. Esto depende del compilador.

Esto se convierte en un problema grave cuando una expresión modifica una variable más de una vez entre dos "puntos de secuencia". Hacerlo resulta en **comportamiento indefinido**.

**Ejemplos de Comportamiento Indefinido:**

```c
int i = 5;

// ¡COMPORTAMIENTO INDEFINIDO!
// ¿Se lee 'i' antes o después de incrementarse? No se sabe.
// El resultado puede ser 10, 11, o algo completamente diferente.
int x = i + i++;

// ¡COMPORTAMIENTO INDEFINIDO!
// ¿Qué 'i' se pasa a la función primero? ¿El original o el incrementado?
printf("Valores: %d, %d\n", i, i++);
```

**Excepciones:** Los operadores lógicos `&&` y `||`, el operador condicional `?:` y el operador coma `,` **SÍ** garantizan un orden de evaluación de izquierda a derecha.

## La Regla de Oro: Usa Paréntesis y Escribe Código Claro

Incluso si conoces todas las reglas de precedencia y asociatividad, no confíes en ellas para escribir código complejo.

1.  **Usa paréntesis `()`:** Hacen que el orden de las operaciones sea explícito e inequívoco, tanto para el compilador como para otros programadores. `(a + b) * c` es mucho más claro que `a + b * c` para un lector rápido.
2.  **Evita modificaciones con efectos secundarios en la misma expresión:** No escribas código como `x = i + i++;`. Sepáralo en líneas distintas para que el comportamiento sea predecible.
    ```c
    // Forma segura y predecible
    int x = i;
    i++;
    x = x + i; // O la lógica que realmente necesites
    ```

## Comparación con JavaScript

- Las reglas de **precedencia y asociatividad** en JavaScript son, en su mayor parte, idénticas a las de C.
- La gran diferencia está en el **orden de evaluación**. JavaScript **garantiza** una evaluación estricta de izquierda a derecha de los operandos. Esto significa que `f() + g()` siempre ejecutará `f()` antes que `g()`. Por lo tanto, el comportamiento indefinido de C en expresiones con efectos secundarios no existe de la misma manera en JavaScript, que es más predecible en este aspecto.

## Resumen

- **Precedencia:** Qué operación se hace primero.
- **Asociatividad:** En qué dirección se agrupan los operadores de igual precedencia.
- **Orden de Evaluación:** C **no garantiza** el orden en que se evalúan los operandos (ej. en `a+b`), lo que puede llevar a **comportamiento indefinido** si hay efectos secundarios.
- **Solución:** Usa paréntesis para la claridad y separa las operaciones con efectos secundarios en sentencias distintas.

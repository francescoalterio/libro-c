# 2.7. Conversiones de Tipo

Cuando se mezclan diferentes tipos de datos en una expresión, C utiliza un conjunto de reglas para convertirlos automáticamente antes de realizar la operación. Este proceso, conocido como **conversión implícita** o **coerción**, generalmente convierte el tipo "más pequeño" al "más grande" para evitar la pérdida de información. También es posible forzar una conversión, lo que se conoce como **conversión explícita** o **casting**.

## Conversiones Implícitas (Automáticas)

Estas conversiones ocurren automáticamente cuando un operador tiene operandos de diferentes tipos. El compilador sigue una jerarquía de tipos.

**Regla General:** En una expresión, los operandos de tipo "inferior" se promueven a un tipo "superior" para que la operación se realice en ese tipo.

1.  **Promoción Entera:** Los tipos `char` y `short int` (tanto `signed` como `unsigned`) se promueven automáticamente a `int` (o `unsigned int` si `int` no puede representar todos los valores del tipo original) en cualquier expresión. Esto se hace para que las operaciones se realicen de manera eficiente en el tamaño de palabra nativo del procesador.

    ```c
    char c = 'A';
    int i = c + 1; // 'c' se promueve a int (valor ASCII 65) antes de sumar 1. El resultado es 66.
    ```

2.  **Jerarquía de Conversión Aritmética:** Si después de la promoción entera los operandos aún tienen tipos diferentes, se aplica la siguiente jerarquía (de mayor a menor):

    - `long double`
    - `double`
    - `float`
    - `unsigned long int`
    - `long int`
    - `unsigned int`
    - `int`

    El operando de tipo inferior se convierte al tipo del operando superior.

    ```c
    int i = 10;
    float f = 3.14;
    double d = i + f; // i se convierte a float, se suma con f. El resultado (float) se convierte a double para la asignación.
    ```

## Conversiones en Asignaciones

En una asignación, el valor del lado derecho se convierte al tipo de la variable del lado izquierdo. Esto puede causar pérdida de información si el tipo de destino es "más pequeño".

```c
int i;
double d = 3.14159;
i = d; // 'd' se trunca a 3. Se pierde la parte decimal. El compilador puede emitir una advertencia.
```

## Conversión Explícita (Casting)

El _casting_ es una forma de indicarle explícitamente al compilador que convierta un valor a un tipo específico. Se utiliza el operador de cast: `(nombre-de-tipo) expresion`.

El uso más común es en la división de enteros para obtener un resultado con decimales:

```c
int total = 19;
int cantidad = 5;

// Sin cast: la división de enteros trunca el resultado.
double promedio_incorrecto = total / cantidad; // El resultado es 3.0

// Con cast: forzamos una división de punto flotante.
double promedio_correcto = (double)total / cantidad; // El resultado es 3.8
```

En `promedio_correcto`, `total` se convierte a `double` (19.0) _antes_ de la división. Debido a las reglas de conversión implícita, `cantidad` también se promueve a `double` para la operación.

## Comparación con JavaScript

JavaScript también realiza conversiones de tipo, pero de una manera mucho más agresiva y, a veces, sorprendente, conocida como "coerción de tipo".

- **C es Estricto:** Las conversiones en C siguen reglas predecibles. La conversión explícita (`cast`) es una herramienta para el programador, no una necesidad para operaciones básicas. El compilador a menudo advierte sobre conversiones potencialmente peligrosas (como de `double` a `int`).
- **JavaScript es Flexible (a veces demasiado):** Intenta "adivinar" la intención, lo que puede llevar a resultados inesperados.

```javascript
// JS intenta ser útil
let resultado = "5" - 1; // resultado es 4 (number)
let otro = "5" + 1; // resultado es "51" (string), porque '+' también es concatenación

// En C, operar con una cadena y un número así sería un error de compilación.
```

## Resumen

- **Implícita:** Ocurre automáticamente, promoviendo tipos "pequeños" a "grandes" para evitar pérdida de datos. `char` y `short` siempre se promueven a `int`.
- **Explícita (Cast):** Permite al programador forzar una conversión, lo cual es crucial para operaciones como la división de enteros.
- **Pérdida de Datos:** Ten cuidado al convertir de un tipo más grande a uno más pequeño (ej. `double` a `int`), ya que puede haber truncamiento o desbordamiento.
- El sistema de tipos de C es más predecible y seguro que la coerción dinámica de JavaScript.

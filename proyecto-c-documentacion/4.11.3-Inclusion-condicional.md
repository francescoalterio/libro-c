# 4.11.3. Inclusión Condicional

La **inclusión condicional** es una característica del preprocesador de C que permite incluir o excluir bloques de código del archivo fuente que se pasa al compilador, basándose en ciertas condiciones evaluadas en tiempo de preprocesamiento. Es una herramienta esencial para escribir código portable, gestionar configuraciones de compilación (como depuración vs. producción) y prevenir problemas como la inclusión múltiple de archivos de encabezado.

## Directivas de Compilación Condicional

### 1. `#if`, `#elif`, `#else`, `#endif`

Estas directivas funcionan de manera análoga a las proposiciones `if-else if-else` de C, pero son evaluadas por el preprocesador. La condición que se evalúa debe ser una **expresión constante entera**.

```c
#define VERSION 3

#if VERSION == 1
    // Código específico para la versión 1
#elif VERSION == 2
    // Código específico para la versión 2
#else
    // Código para cualquier otra versión (incluyendo la 3)
#endif
```

Si `VERSION` se define como `2`, solo el "Código específico para la versión 2" será parte del archivo que el compilador reciba. El resto se descarta.

### 2. `#ifdef` y `#ifndef`

Estas son las directivas condicionales más comunes. No comprueban el valor de una macro, sino simplemente si ha sido **definida** o no.

- **`#ifdef NOMBRE_MACRO`**: "if defined". El bloque de código se incluye si `NOMBRE_MACRO` ha sido previamente definida con `#define`.
- **`#ifndef NOMBRE_MACRO`**: "if not defined". El bloque de código se incluye si `NOMBRE_MACRO` **no** ha sido definida.

**Ejemplo: Código de Depuración**
Se puede controlar la inclusión de código de depuración definiendo o no una macro `DEBUG`.

```c
#define DEBUG // Comentar esta línea para una compilación de producción

void mi_funcion(int *puntero) {
    #ifdef DEBUG
        if (puntero == NULL) {
            fprintf(stderr, "Error en mi_funcion: puntero nulo recibido.\n");
        }
    #endif
    // ... resto de la función ...
}
```

El bloque `#ifdef` solo se compilará si la línea `#define DEBUG` está presente. En una compilación para producción, se comenta o elimina esa línea, y todo el código de depuración desaparece del ejecutable final, sin ningún coste de rendimiento.

### 3. El Operador `defined`

El operador `defined` se puede usar dentro de una directiva `#if` o `#elif` y devuelve `1` si su operando (una macro) está definido, y `0` si no lo está. Permite construir condiciones más complejas.

`#ifdef DEBUG` es simplemente un atajo para `#if defined(DEBUG)`.

**Uso para condiciones complejas:**

```c
#if defined(WINDOWS_OS) && defined(USE_GRAPHICS)
    // Código específico para Windows con gráficos activados
#endif
```

## Casos de Uso Fundamentales

### 1. Guardias de Inclusión (Include Guards)

Este es el caso de uso más importante de `#ifndef`. Como se vio anteriormente, previene que el contenido de un archivo de encabezado se incluya más de una vez en la misma unidad de traducción.

```c
// En mi_header.h
#ifndef MI_HEADER_H
#define MI_HEADER_H

// ... contenido del header ...

#endif
```

### 2. Portabilidad entre Sistemas Operativos

Se pueden usar macros predefinidas por el compilador para escribir código que se adapte a diferentes sistemas operativos o arquitecturas.

```c
#include <stdio.h>

void limpiar_pantalla() {
    #if defined(_WIN32) || defined(_WIN64)
        // Comando para Windows
        system("cls");
    #elif defined(__linux__) || defined(__APPLE__)
        // Comando para Linux y macOS
        system("clear");
    #else
        printf("Sistema operativo no soportado para limpiar pantalla.\n");
    #endif
}
```

## Comparación con JavaScript

JavaScript, al ser un lenguaje interpretado (o compilado en tiempo de ejecución, JIT), no tiene un concepto de compilación condicional como C. La lógica condicional se resuelve siempre en tiempo de ejecución con `if-else`.

Sin embargo, en el ecosistema de desarrollo moderno, las herramientas de construcción (_build tools_) y empaquetadores (_bundlers_) como **Webpack** o **Vite** pueden lograr un efecto similar. Pueden configurarse con variables de entorno (ej. `NODE_ENV='production'`) y, durante el proceso de empaquetado, eliminar bloques de código que estén dentro de condicionales como `if (process.env.NODE_ENV !== 'production') { ... }`. Este proceso se conoce como **eliminación de código muerto** (_dead code elimination_ o _tree shaking_) y es una optimización clave para reducir el tamaño de los paquetes de producción.

## Resumen

- La inclusión condicional permite al preprocesador incluir o excluir porciones de código antes de la compilación.
- `#if`, `#elif`, `#else`, `#endif` evalúan expresiones constantes.
- `#ifdef` y `#ifndef` comprueban si una macro está definida o no.
- Sus usos principales son los **include guards**, la gestión de **código de depuración** y la escritura de **código portable** entre diferentes plataformas.
- Es una herramienta poderosa para controlar lo que finalmente llega al compilador.

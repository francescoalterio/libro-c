# 4.2. Funciones que Regresan Valores No Enteros

Aunque muchos ejemplos iniciales utilizan funciones que devuelven `int`, las funciones en C son mucho más versátiles y pueden devolver valores de prácticamente cualquier tipo de dato, incluyendo `float`, `double`, `char`, punteros, e incluso estructuras (`struct`).

## La Importancia de la Declaración (Prototipo)

Cuando una función devuelve un tipo de dato diferente de `int`, es **esencial** que el compilador conozca el tipo de retorno antes de que la función sea llamada. Si no se proporciona un prototipo y la función se define después de su uso, el compilador de C asume por defecto que la función devuelve un `int`. Esto puede llevar a errores sutiles y difíciles de depurar.

**Regla de Oro:** Siempre declara un prototipo para cualquier función que no devuelva `int` antes de llamarla. En la práctica moderna, se deben crear prototipos para **todas** las funciones.

## Ejemplo: Una Función que Devuelve `double`

Imaginemos una función `atof` (ASCII to float) que convierte una cadena de caracteres (como "123.45") a su equivalente numérico de tipo `double`.

**Código con prototipo (forma correcta):**

```c
#include <stdio.h>
#include <ctype.h> // Para isdigit()

// Prototipo: informa al compilador que atof devuelve un double
double atof(char s[]);

int main() {
    char numero_str[] = "123.45";
    double numero_val;

    // La llamada a atof se realiza correctamente porque main conoce el tipo de retorno.
    numero_val = atof(numero_str);

    printf("La cadena '%s' es el número %f\n", numero_str, numero_val);
    // La función printf usa %f para imprimir doubles.
    // Si numero_val fuera tratado como int, la salida sería incorrecta.

    return 0;
}

// Definición de la función atof
double atof(char s[]) {
    double val, power;
    int i, sign;

    // Omitir espacios en blanco
    for (i = 0; isspace(s[i]); i++)
        ;

    sign = (s[i] == '-') ? -1 : 1;
    if (s[i] == '+' || s[i] == '-')
        i++;

    // Parte entera
    for (val = 0.0; isdigit(s[i]); i++)
        val = 10.0 * val + (s[i] - '0');

    // Parte decimal
    if (s[i] == '.')
        i++;
    for (power = 1.0; isdigit(s[i]); i++) {
        val = 10.0 * val + (s[i] - '0');
        power *= 10.0;
    }

    return sign * val / power;
}
```

### ¿Qué pasaría sin el prototipo?

Si la línea `double atof(char s[]);` se omite, el compilador en `main` no sabría que `atof` devuelve un `double`. Asumiría que devuelve un `int`. Cuando `atof` realmente devuelva el valor `123.45`, `main` podría interpretarlo incorrectamente, llevando a un valor basura o a un comportamiento indefinido. La llamada a `printf` probablemente imprimiría un número incorrecto porque estaría recibiendo bits que representan un `double` pero intentando interpretarlos como si fueran un `int` (o viceversa, dependiendo de la arquitectura).

## La Proposición `return`

La expresión en la proposición `return` se convierte al tipo de retorno de la función si es necesario.

```c
double mi_funcion() {
    int x = 10;
    // El valor de x (10) se convierte a double (10.0) antes de ser devuelto.
    return x;
}
```

Si una función declara que devuelve un valor (ej. `double mi_funcion()`), pero no tiene una proposición `return` o la proposición `return` no tiene una expresión, el valor devuelto es indefinido (basura).

## Comparación con JavaScript

- **C (Tipado Estático):** El tipo de retorno es parte del "contrato" de la función. Se declara explícitamente y el compilador lo verifica. Esto ayuda a prevenir errores en tiempo de compilación.
- **JavaScript (Tipado Dinámico):** Una función puede devolver cualquier tipo de dato, y no se declara de antemano. El tipo del valor devuelto se determina en tiempo de ejecución. Esto ofrece flexibilidad, pero puede hacer que los errores de tipo solo se descubran al ejecutar el código.

```javascript
function miFuncion(condicion) {
  if (condicion) {
    return "Hola"; // Devuelve un string
  } else {
    return 123; // Devuelve un número
  }
}
```

Este patrón es común en JavaScript pero sería un error en C.

## Resumen

- Las funciones en C pueden devolver cualquier tipo de dato único.
- Es **crítico** declarar un **prototipo** para la función antes de su uso, especialmente si no devuelve `int`, para que el compilador sepa cómo manejar el valor de retorno correctamente.
- La expresión en la proposición `return` se convierte al tipo de retorno de la función.
- La falta de un prototipo para funciones que no devuelven `int` es una fuente clásica de errores en C.

# 4.4. Reglas de Alcance (Scope)

El **alcance** (o _scope_) de un identificador (como el nombre de una variable o una función) define la región del código fuente en la que ese identificador es visible y puede ser utilizado. C tiene un conjunto de reglas bien definidas para determinar el alcance, lo cual es fundamental para evitar colisiones de nombres y para estructurar correctamente un programa.

Las funciones y las variables externas (globales) tienen un alcance que comienza en su punto de declaración y se extiende hasta el final del archivo. Las variables locales, por otro lado, tienen un alcance mucho más restringido.

## Niveles de Alcance

### 1. Alcance de Bloque (Local)

Este es el tipo de alcance más común.

- **Definición:** Una variable declarada dentro de un bloque `{...}`. Esto incluye el cuerpo de una función, los bloques dentro de un `if`, `while`, `for`, o incluso un bloque independiente.
- **Visibilidad:** La variable es visible solo desde su punto de declaración hasta la llave de cierre `}` del bloque.
- **Ciclo de Vida:** La variable se crea (y se le asigna memoria, usualmente en la pila) cuando la ejecución entra en el bloque y se destruye (su memoria se libera) cuando la ejecución sale del bloque. Estas variables se conocen como **variables automáticas**.

```c
void mi_funcion() {
    int x = 10; // 'x' tiene alcance de bloque (toda la función)

    if (x > 5) {
        double y = 20.5; // 'y' tiene alcance de bloque (solo dentro del if)
        printf("x=%d, y=%f\n", x, y); // Correcto
    }

    // printf("y=%f\n", y); // ¡ERROR! 'y' no existe aquí.
}
```

Los parámetros de una función también tienen alcance de bloque; son locales al cuerpo de la función.

### 2. Alcance de Archivo (Global)

- **Definición:** Un identificador declarado fuera de cualquier función.
- **Visibilidad:** Es visible desde su punto de declaración hasta el final del archivo fuente.
- **Ciclo de Vida:** Existe durante toda la ejecución del programa. Se le asigna memoria estática al inicio del programa y solo se libera cuando el programa termina.

```c
#include <stdio.h>

int contador_global = 100; // Alcance de archivo

void func1() {
    contador_global++; // Visible y modificable aquí
}

void func2() {
    printf("%d\n", contador_global); // Visible aquí
}
```

Si otro archivo (`otro.c`) quisiera acceder a `contador_global`, necesitaría declararlo con `extern int contador_global;`.

## Ocultamiento de Nombres (Name Hiding o Shadowing)

Si una variable local en un bloque interno tiene el mismo nombre que una variable en un bloque externo, la variable local **oculta** a la externa dentro de su bloque.

```c
#include <stdio.h>

int x = 100; // Global 'x'

int main() {
    int x = 50; // Local 'x' en main, oculta a la global

    printf("x en main = %d\n", x); // Imprime 50

    { // Nuevo bloque interno
        int x = 10; // Otra 'x' local, oculta a la 'x' de main
        printf("x en bloque interno = %d\n", x); // Imprime 10
    }

    printf("x de nuevo en main = %d\n", x); // Imprime 50

    return 0;
}
```

**Salida:**

```
x en main = 50
x en bloque interno = 10
x de nuevo en main = 50
```

La variable global `x` (con valor 100) nunca fue accedida porque siempre estuvo oculta por una variable local con el mismo nombre. Aunque esto es sintácticamente válido, **es una mala práctica de programación** porque puede llevar a confusiones y errores. Se debe evitar el ocultamiento de nombres siempre que sea posible.

## Comparación con JavaScript

El concepto de alcance en JavaScript ha evolucionado, pero se puede comparar de la siguiente manera:

- **Alcance de Bloque:** Las variables declaradas con `let` y `const` en JavaScript tienen alcance de bloque, comportándose de manera muy similar a las variables locales en C.
  ```javascript
  if (true) {
    let x = 10; // Alcance de bloque
  }
  // console.log(x); // ReferenceError
  ```
- **Alcance de Función:** Las variables declaradas con `var` en JavaScript tienen alcance de función, no de bloque. Esto significa que son visibles en toda la función, sin importar en qué bloque se declararon. No hay un equivalente directo en C.
- **Alcance Global:** En JavaScript, una variable declarada fuera de toda función en el nivel superior de un script tiene alcance global. En el contexto de módulos (ES6), el alcance global es por módulo, no realmente global para toda la aplicación, lo que se asemeja más al alcance de archivo en C.

El ocultamiento de nombres (shadowing) también existe en JavaScript y funciona de manera similar.

## Resumen

- El **alcance** determina la visibilidad de un identificador.
- **Variables locales (automáticas):** Tienen alcance de bloque `{...}` y un ciclo de vida temporal.
- **Variables globales (externas):** Tienen alcance de archivo y un ciclo de vida permanente.
- Una variable en un bloque interno puede **ocultar** (shadow) a una variable con el mismo nombre en un bloque externo. Esta es una práctica que se debe evitar.
- **Principio de Mínimo Alcance:** Como regla general, declara siempre las variables en el alcance más pequeño y restringido posible. Si una variable solo se necesita dentro de un `if`, declárala ahí, no al principio de la función. Esto reduce la posibilidad de errores.

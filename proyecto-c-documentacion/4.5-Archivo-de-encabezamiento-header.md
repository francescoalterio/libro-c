# 4.5. Archivos de Encabezado (Header Files)

A medida que un programa crece, se vuelve impráctico mantener todo el código en un solo archivo. La práctica estándar es dividir el programa en múltiples archivos `.c`, cada uno conteniendo un conjunto de funciones relacionadas. Para que estos archivos puedan cooperar, necesitan una forma de compartir declaraciones de funciones, tipos y variables. Aquí es donde entran los **archivos de encabezado** (comúnmente con la extensión `.h`).

Un archivo de encabezado actúa como la **interfaz pública** de un módulo de código (`.c`). Contiene las declaraciones que otros archivos necesitan para poder utilizar las funcionalidades de ese módulo.

## Contenido Típico de un Archivo de Encabezado

Un archivo `.h` generalmente contiene:

1.  **Prototipos de funciones:** Las declaraciones de las funciones que son públicas y pueden ser llamadas desde otros archivos.
2.  **Definiciones de macros:** Constantes simbólicas definidas con `#define`.
3.  **Declaraciones de `struct`, `union` y `enum`:** Definiciones de tipos de datos personalizados.
4.  **Declaraciones `extern` de variables globales:** Para compartir variables globales entre archivos (aunque esto debe hacerse con moderación).

**Lo que NO debe contener:**

- **Definiciones de funciones:** El cuerpo `{...}` de una función pertenece al archivo `.c`. Si defines una función en un header y este es incluido por varios archivos, obtendrás un error de "definición múltiple" del enlazador (linker).
- **Definiciones de variables globales:** `int mi_var = 10;` pertenece al `.c`. El header solo debe tener `extern int mi_var;`.

## El Problema de la Inclusión Múltiple y los "Include Guards"

Si un archivo de encabezado es incluido más de una vez en el mismo archivo `.c` (a menudo de forma indirecta, ej. `a.h` incluye `b.h`, y `mi_codigo.c` incluye tanto `a.h` como `b.h`), el compilador verá las mismas declaraciones dos veces. Esto puede causar errores de "redefinición".

Para prevenir esto, se utiliza una construcción del preprocesador llamada **guardia de inclusión** (_include guard_).

**Sintaxis del Include Guard:**

```c
#ifndef NOMBRE_UNICO_H
#define NOMBRE_UNICO_H

// ... Contenido del archivo de encabezado ...
// (prototipos, #defines, etc.)

#endif // NOMBRE_UNICO_H
```

**Cómo funciona:**

1.  La primera vez que se incluye el archivo, la macro `NOMBRE_UNICO_H` no está definida.
2.  `#ifndef` (if not defined) es verdadero, por lo que el preprocesador entra en el bloque.
3.  `#define NOMBRE_UNICO_H` define la macro.
4.  El resto del archivo se procesa normalmente.
5.  Si el mismo archivo se intenta incluir de nuevo, `NOMBRE_UNICO_H` ya estará definida.
6.  `#ifndef` será falso, y el preprocesador se saltará todo el contenido hasta `#endif`, evitando la redefinición.

La convención es usar el nombre del archivo en mayúsculas con guiones bajos como el nombre de la macro (ej. `mi_libreria.h` -> `MI_LIBRERIA_H`).

## Ejemplo Práctico

Imaginemos un módulo para operaciones con cadenas.

**`str_utils.h`**

```c
#ifndef STR_UTILS_H
#define STR_UTILS_H

// Prototipo de la función pública
int contar_caracteres(const char *cadena);

// Constante simbólica
#define MAX_STR_LEN 256

#endif // STR_UTILS_H
```

**`str_utils.c`**

```c
#include "str_utils.h" // Incluye su propio header para consistencia
#include <stddef.h>   // Para NULL

// Definición (implementación) de la función
int contar_caracteres(const char *cadena) {
    if (cadena == NULL) {
        return 0;
    }
    int contador = 0;
    while (cadena[contador] != '\0') {
        contador++;
    }
    return contador;
}
```

**`main.c`**

```c
#include <stdio.h>
#include "str_utils.h" // Incluye la interfaz para usar sus funciones

int main() {
    char mi_cadena[MAX_STR_LEN] = "Hola mundo";
    int longitud = contar_caracteres(mi_cadena);

    printf("La cadena '%s' tiene %d caracteres.\n", mi_cadena, longitud);
    return 0;
}
```

## `#include <...>` vs. `#include "..."`

- **`#include <archivo.h>`**: Se usa para los encabezados de la **biblioteca estándar** de C (ej. `<stdio.h>`, `<stdlib.h>`). El compilador busca estos archivos en los directorios del sistema.
- **`#include "archivo.h"`**: Se usa para los encabezados **creados por el programador** que forman parte del proyecto. El compilador busca primero en el directorio actual del archivo fuente y luego en otras rutas especificadas.

## Comparación con JavaScript (Módulos ES6)

El sistema de `import`/`export` de JavaScript cumple un rol análogo al de los archivos de encabezado.

- **`#include "utils.h"`** es como **`import { miFunc } from './utils.js'`**. Ambos declaran la intención de usar código de otro módulo.
- El contenido de `utils.h` (los prototipos) es como la lista de funciones y variables en la sentencia `export` de `utils.js`.
- El sistema de módulos de JS maneja automáticamente las dependencias y evita la "inclusión múltiple" sin necesidad de guardias manuales.

## Resumen

- Los archivos de encabezado (`.h`) definen la **interfaz pública** de un módulo de código.
- Contienen prototipos de funciones y otras declaraciones compartidas.
- **Siempre** deben protegerse con **guardias de inclusión** (`#ifndef`/`#define`/`#endif`) para evitar errores de redefinición.
- `#include <...>` es para bibliotecas del sistema; `#include "..."` es para los archivos de tu proyecto.
- Son la piedra angular de la programación modular y organizada en C.

# 7.1. Definición de Archivos y Flujos (Streams)

En el contexto de la programación, un **archivo** es una secuencia de bytes almacenada en un dispositivo de almacenamiento persistente (como un disco duro, SSD, etc.). Es un contenedor de datos que permanece incluso después de que el programa que lo creó ha terminado su ejecución.

El lenguaje C no tiene tipos de datos de archivo incorporados. En su lugar, proporciona un conjunto de funciones en la biblioteca estándar (`<stdio.h>`) que permiten interactuar con los archivos del sistema operativo de una manera estandarizada.

## El Concepto de Flujo (Stream)

C introduce una capa de abstracción sobre los archivos llamada **flujo** (_stream_). Un flujo es un canal de comunicación a través del cual los datos fluyen desde una fuente (como un archivo, el teclado o incluso la memoria) hacia un destino (un archivo, la pantalla, etc.).

- **Fuente (Entrada):** Cuando leemos datos, estos fluyen _desde_ el archivo _hacia_ nuestro programa.
- **Destino (Salida):** Cuando escribimos datos, estos fluyen _desde_ nuestro programa _hacia_ el archivo.

Esta abstracción es poderosa porque nos permite usar el mismo conjunto de funciones (como `fprintf`, `fscanf`, `fgetc`) para interactuar con diferentes tipos de dispositivos. Por ejemplo, `printf(...)` es simplemente `fprintf(stdout, ...)` que escribe en el flujo de salida estándar (la pantalla), y `scanf(...)` es `fscanf(stdin, ...)` que lee del flujo de entrada estándar (el teclado).

## El Puntero `FILE`

Para trabajar con un archivo en C, utilizamos un tipo de dato especial definido en `<stdio.h>`: `FILE`.

`FILE` es una estructura que contiene toda la información necesaria para gestionar un flujo, como:

- La ubicación actual de lectura/escritura en el archivo (el cursor o puntero de posición).
- Un búfer para mejorar la eficiencia de las operaciones de E/S.
- Indicadores de error y de fin de archivo.

No necesitamos conocer los detalles internos de la estructura `FILE`. Simplemente usamos un **apuntador a `FILE`** (`FILE *`) para identificar y manipular un flujo de archivo abierto. Este puntero se obtiene al abrir un archivo con la función `fopen()`.

```c
#include <stdio.h>

int main() {
    // Declaramos un apuntador a FILE.
    FILE *mi_archivo;

    // Intentamos abrir un archivo. fopen devuelve un apuntador a FILE.
    mi_archivo = fopen("datos.txt", "w");

    if (mi_archivo == NULL) {
        // Si fopen falla, devuelve NULL.
        printf("Error al abrir el archivo.\n");
        return 1;
    }

    // ... aquí irían las operaciones de escritura ...
    fprintf(mi_archivo, "Hola, mundo de los archivos.\n");

    // Es crucial cerrar el archivo cuando terminamos.
    fclose(mi_archivo);

    return 0;
}
```

## Tipos de Archivos

Desde la perspectiva de C, los archivos se pueden abrir en dos modos principales:

1.  **Archivos de Texto (`"t"` en el modo de `fopen`)**:

    - Son secuencias de caracteres organizadas en líneas.
    - Cada línea termina con un carácter de nueva línea (`\n`).
    - El sistema operativo puede realizar traducciones de caracteres. Por ejemplo, en Windows, el carácter de nueva línea (`\n`) se traduce automáticamente a una secuencia de retorno de carro y avance de línea (`\r\n`) al escribir, y viceversa al leer.
    - Son legibles por humanos.

2.  **Archivos Binarios (`"b"` en el modo de `fopen`)**:
    - Son secuencias de bytes sin procesar.
    - No hay una estructura de "líneas". Los datos se leen y escriben tal como están en la memoria (por ejemplo, la representación binaria de un `int` o un `struct`).
    - No se realiza ninguna traducción de caracteres.
    - Son ideales para almacenar datos de manera compacta y eficiente, pero no son directamente legibles por humanos.

## Comparación con JavaScript

La gestión de archivos en C es muy diferente a la de JavaScript, principalmente debido a los entornos en los que se ejecutan.

- **C (Entorno de Sistema):** Como lenguaje de sistema, C tiene acceso directo y completo al sistema de archivos del sistema operativo. Las funciones de `<stdio.h>` son una interfaz directa para estas capacidades.

- **JavaScript (Entorno de Navegador):** Por razones de seguridad, el JavaScript que se ejecuta en un navegador tiene un acceso al sistema de archivos del usuario **extremadamente restringido**. No puede leer o escribir archivos arbitrariamente. El acceso se realiza a través de APIs seguras que requieren la interacción explícita del usuario:

  - **File API:** Permite a las aplicaciones web acceder al contenido de archivos seleccionados por el usuario a través de un input `<input type="file">`.
  - **FileReader:** Permite leer el contenido de esos archivos de forma asíncrona.

- **JavaScript (Entorno de Servidor - Node.js):** Node.js, al ejecutarse en un servidor, sí tiene acceso completo al sistema de archivos, de manera similar a C. Proporciona un módulo `fs` (_file system_) con funciones para leer y escribir archivos de forma síncrona y asíncrona.
  ```javascript
  const fs = require("fs");
  fs.writeFileSync("datos.txt", "Hola desde Node.js");
  ```

## Resumen

- Un **archivo** es una colección de datos persistente en un dispositivo de almacenamiento.
- C interactúa con los archivos a través de una abstracción llamada **flujo (stream)**.
- Se utiliza un apuntador a la estructura `FILE` (`FILE *`) para gestionar un flujo de archivo abierto.
- Los archivos pueden ser de **texto** (con formato de líneas y traducción de caracteres) o **binarios** (bytes sin procesar).
- El acceso directo al sistema de archivos en C contrasta con el acceso restringido y mediado por el usuario en el JavaScript de navegador, aunque es similar al módulo `fs` de Node.js.

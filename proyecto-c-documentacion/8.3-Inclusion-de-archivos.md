# 8.3. Inclusión de Archivos con `#include`

La directiva `#include` es la piedra angular de la modularidad en C. Su función es simple: le ordena al preprocesador que encuentre el archivo especificado y reemplace la línea `#include` con el contenido completo de ese archivo. Este proceso permite dividir un programa grande en múltiples archivos fuente, mejorando la organización, la reutilización y el mantenimiento del código.

## Formas de `#include`

Existen dos sintaxis para usar `#include`, y la elección entre ellas le indica al preprocesador dónde debe buscar el archivo.

### 1. `#include <nombre_archivo.h>` (Corchetes Angulares)

- **Uso**: Para incluir archivos de cabecera de la **biblioteca estándar del sistema** o de otras bibliotecas instaladas en el sistema.
- **Ruta de Búsqueda**: El preprocesador busca `nombre_archivo.h` en una lista predefinida de directorios del sistema. Estos directorios son parte de la configuración del compilador y no incluyen el directorio del proyecto actual.

**Ejemplo:**

```c
#include <stdio.h>      // Para funciones de E/S como printf
#include <stdlib.h>     // Para funciones como malloc y exit
#include <string.h>     // Para funciones de manipulación de cadenas
#include <math.h>       // Para funciones matemáticas
```

### 2. `#include "nombre_archivo.h"` (Comillas Dobles)

- **Uso**: Para incluir archivos de cabecera que **forman parte de tu propio proyecto**.
- **Ruta de Búsqueda**: El preprocesador busca primero `nombre_archivo.h` en el **mismo directorio** que el archivo fuente que contiene la directiva. Si no lo encuentra allí, entonces busca en la misma lista de directorios del sistema que usaría para la forma `<...>`.

**Ejemplo:**
Supongamos la siguiente estructura de proyecto:

```
proyecto/
├── main.c
├── modulos/
│   ├── utils.h
│   └── utils.c
```

En `main.c`, incluiríamos `utils.h` así:

```c
// main.c
#include <stdio.h>
#include "modulos/utils.h" // Ruta relativa al archivo main.c

int main() {
    saludar("Mundo");
    return 0;
}
```

## El Problema de la Inclusión Múltiple y la Solución

Un problema común ocurre cuando un archivo de cabecera es incluido más de una vez en la misma unidad de compilación. Esto puede suceder en proyectos complejos donde varios archivos de cabecera se incluyen entre sí.

**Ejemplo del Problema:**
`a.h` incluye `c.h`.
`b.h` incluye `c.h`.
`main.c` incluye `a.h` y `b.h`.

Cuando `main.c` se preprocesa, el contenido de `c.h` se insertará dos veces, lo que causará errores de "redefinición" por parte del compilador (por ejemplo, si `c.h` define una `struct`).

### La Solución: Guardas de Inclusión (Include Guards)

Para prevenir este problema, se utiliza una construcción del preprocesador llamada **guarda de inclusión**. Es una práctica estándar y esencial que debe aplicarse a **todos** los archivos de cabecera.

La técnica consiste en envolver todo el contenido del archivo de cabecera en un bloque de compilación condicional.

**Estructura de una Guarda de Inclusión en `mi_cabecera.h`:**

```c
// mi_cabecera.h

#ifndef MI_CABECERA_H_  // Si MI_CABECERA_H_ no ha sido definido...
#define MI_CABECERA_H_  // ...defínelo ahora.

// --- TODO EL CONTENIDO DEL ARCHIVO DE CABECERA VA AQUÍ ---
struct MiEstructura {
    int dato;
};

void mi_funcion(void);
// --- FIN DEL CONTENIDO ---

#endif // MI_CABECERA_H_
```

**Cómo funciona:**

1.  **Primera Inclusión**: La primera vez que se incluye `mi_cabecera.h`, el símbolo `MI_CABECERA_H_` no está definido.
2.  `#ifndef` es verdadero, por lo que el preprocesador entra en el bloque.
3.  `#define MI_CABECERA_H_` define el símbolo.
4.  El contenido del archivo se incluye en el código fuente.
5.  **Inclusiones Subsiguientes**: En cualquier inclusión posterior del mismo archivo dentro de la misma compilación, `MI_CABECERA_H_` ya estará definido.
6.  `#ifndef` será falso, y el preprocesador saltará directamente al `#endif`, ignorando todo el contenido intermedio y evitando así la redefinición.

El nombre de la macro de la guarda (`MI_CABECERA_H_`) debe ser único en todo el proyecto. Una convención común es usar el nombre del archivo en mayúsculas, reemplazando puntos y otros caracteres por guiones bajos.

## `#pragma once`

Muchos compiladores modernos soportan una directiva no estándar pero muy extendida que logra el mismo objetivo que las guardas de inclusión con menos código:
`#pragma once`

Si se coloca al principio de un archivo de cabecera, le indica al compilador que solo incluya este archivo una vez por unidad de compilación.

**Ejemplo:**

```c
// mi_cabecera.h
#pragma once

// Contenido del archivo...
```

Aunque es más simple, las guardas de inclusión (`#ifndef`/`#define`/`#endif`) son universalmente portables y garantizan el funcionamiento en cualquier compilador de C estándar.

## Resumen

- `#include` es la directiva para insertar el contenido de un archivo en otro.
- Usa `<...>` para bibliotecas del sistema y `"...`" para los archivos de tu propio proyecto.
- La inclusión múltiple de un mismo cabecera causa errores de redefinición.
- **Siempre** protege tus archivos de cabecera con **guardas de inclusión** (`#ifndef`/`#define`/`#endif`) o `#pragma once` para evitar este problema.
